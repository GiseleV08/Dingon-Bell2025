<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"> 
<title>Amigo Secreto de Natal</title>
<style>
  :root{
    --card-bg: rgba(255,255,255,0.95);
    --accent: #c91818;
    --accent-dark: #9f1010;
    --green: #0b6b2a;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;-webkit-font-smoothing:antialiased}
  body{
    background: linear-gradient(180deg,#05233b 0%, #083a4d 60%);
    display:flex;align-items:center;justify-content:center;padding:20px;box-sizing:border-box;overflow:hidden
  }
  .bg-ornament{
    position:fixed;inset:0;pointer-events:none;opacity:.12;background-image:url('https://i.imgur.com/0ZfL4Jw.jpeg');background-size:cover;background-position:center;filter:blur(4px) saturate(.9);
  }
  .container{
    width:100%;max-width:440px;padding:18px;border-radius:18px;background:var(--card-bg);box-shadow:0 10px 30px rgba(2,8,23,0.45);backdrop-filter:blur(6px);position:relative;z-index:2;
    box-sizing:border-box;display:flex;flex-direction:column;align-items:stretch;
    -webkit-tap-highlight-color: transparent;
  }
  header{display:flex;align-items:center;gap:12px}
  .logo{
    width:56px;height:56px;border-radius:12px;background:linear-gradient(180deg,var(--accent),var(--accent-dark));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;
    font-size:2em;
  }
  h1{font-size:18px;margin:0;color:var(--accent-dark);letter-spacing:.2px}
  p.lead{margin:6px 0 14px;color:#334;opacity:.9;font-size:13px}

  label, .edit-list-label{font-size:13px;color:#333}
  input#nome, textarea#edit-list{width:100%;padding:14px;border-radius:12px;border:1px solid #e1e1e1;font-size:16px;box-sizing:border-box;margin-top:8px}
  .controls{display:flex;gap:10px;margin-top:12px}
  button{flex:1;padding:12px;border-radius:12px;border:none;font-size:16px;background:var(--accent);color:white;font-weight:600;cursor:pointer;box-shadow:0 6px 14px rgba(201,24,24,0.18);transition:transform .1s}
  button.secondary{background:#f5f5f5;color:#333;box-shadow:none;border:1px solid #e6e6e6}
  button:active{transform:translateY(1px)}
  button:disabled{background: #e6e6e6; color: #aaa; cursor:not-allowed;}

  #resultado{margin-top:16px;padding:12px;border-radius:10px;background:linear-gradient(90deg,rgba(11,107,42,0.08),rgba(11,107,42,0.03));color:var(--green);font-weight:700;text-align:center}

  .meta{display:flex;justify-content:space-between;align-items:center;margin-top:12px;font-size:12px;color:#666}

  .edit-list-area{margin-top:18px;}
  textarea#edit-list{height:56px; resize:vertical; font-size:14px;}
  .edit-list-label{display:block;margin-bottom:6px;}
  .edit-controls{display:flex;gap:10px;margin-top:8px;}
  .hint{font-size:12px;color:#808080;margin:6px 0 -6px 0;}
  @media (max-width:420px){
    .container{padding:16px;border-radius:16px}
    .logo{width:48px;height:48px}
    h1{font-size:16px}
    input#nome{padding:12px}
    button{padding:14px;font-size:16px}
    textarea#edit-list{height:39px;}
  }
  canvas#snow {
    position:fixed;inset:0;width:100%;height:100%;pointer-events:none;z-index:1
  }
  @media (prefers-reduced-motion: reduce){
    canvas#snow{display:none}
  }
</style>
</head>
<body>
  <div class="bg-ornament" aria-hidden="true"></div>
  <canvas id="snow" aria-hidden="true"></canvas>

  <div class="container" role="application" aria-label="Sorteio de Amigo Secreto">
    <header>
      <div class="logo">üéÅ</div>
      <div>
        <h1>Amigo Secreto de Natal</h1>
        <p class="lead">Digite seu nome e clique em <strong>Sortear</strong> ‚Äî o app n√£o permite que voc√™ tire o pr√≥prio nome.</p>
      </div>
    </header>

    <label for="nome">Seu nome</label>
    <input id="nome" name="nome" inputmode="text" autocomplete="name" placeholder="Ex: Gisele" aria-label="Digite seu nome" />

    <div class="controls">
      <button id="btnSortear" aria-label="Sortear">Sortear üéÑ</button>
      <button id="btnReset" class="secondary" aria-label="Reiniciar">Reiniciar üîÅ</button>
    </div>

    <div id="resultado" role="status" aria-live="polite"></div>

    <div class="meta">
      <span id="restantes">Participantes restantes: 0</span>
      <span id="total">Total: 0</span>
    </div>
    
    <div class="edit-list-area">
      <label for="edit-list" class="edit-list-label">Editar lista de participantes (um nome por linha):</label>
      <textarea id="edit-list" spellcheck="false"></textarea>
      <div class="edit-controls">
        <button id="btnSalvarLista" aria-label="Salvar lista">Salvar lista üíæ</button>
        <button id="btnRestaurarLista" class="secondary" aria-label="Restaurar padr√£o">Repor padr√£o ‚Ü©Ô∏è</button>
      </div>
      <div class="hint">A atualiza√ß√£o da lista reinicia os sorteios.</div>
    </div>
  </div>

<script>
// ====== PARTICIPANTES - Padr√£o ======
const listaPadrao = ["Ana","Bruno","Carlos","Gisele","Rafaela","Marcos","Julia","Pedro"];
let participantes = listaPadrao.slice();
// ==============================================

let jaSorteados = new Set();

const nomeInput = document.getElementById('nome');
const resultadoEl = document.getElementById('resultado');
const btnSortear = document.getElementById('btnSortear');
const btnReset = document.getElementById('btnReset');
const restantesEl = document.getElementById('restantes');
const totalEl = document.getElementById('total');
const editListArea = document.getElementById('edit-list');
const btnSalvarLista = document.getElementById('btnSalvarLista');
const btnRestaurarLista = document.getElementById('btnRestaurarLista');

function limparString(s){
  return s.trim().normalize('NFD').replace(/[-]/g, '').toLowerCase();
}

// Atualiza campos meta
function atualizarMeta(){
  const restantes = participantes.length - jaSorteados.size;
  restantesEl.textContent = `Participantes restantes: ${restantes}`;
  totalEl.textContent = `Total: ${participantes.length}`;
  btnSortear.disabled = restantes === 0;
}

// Sorteio do Amigo Secreto
function sortear(){
  const nomeUsuarioRaw = nomeInput.value.trim();
  const nomeUsuario = limparString(nomeUsuarioRaw);
  const nomesListados = participantes.map(limparString);

  if(!nomeUsuarioRaw){ resultadoEl.textContent = 'Digite seu nome.'; return; }
  if(!nomesListados.includes(nomeUsuario)) { resultadoEl.textContent = 'Nome n√£o encontrado na lista. Confira se h√° erro de digita√ß√£o.'; return; }

  // Nomes dispon√≠veis (n√£o sorteados e n√£o o pr√≥prio)
  const disponiveis = participantes.filter((n, i) => limparString(n) !== nomeUsuario && !jaSorteados.has(i));
  if(disponiveis.length === 0){ resultadoEl.textContent = 'N√£o h√° mais nomes dispon√≠veis para sortear.'; return; }

  btnSortear.disabled = true;
  let ticks = 18;
  let i = 0;
  const indicesDisponiveis = participantes.map((n, idx) => limparString(n) !== nomeUsuario && !jaSorteados.has(idx) ? idx : null).filter(idx => idx !== null);

  const interval = setInterval(()=>{
    const fakeIdx = indicesDisponiveis[Math.floor(Math.random()*indicesDisponiveis.length)];
    resultadoEl.textContent = `Sorteando... ${participantes[fakeIdx]}`;
    i++;
    if(i>=ticks){
      clearInterval(interval);
      const escolhidoIdx = indicesDisponiveis[Math.floor(Math.random()*indicesDisponiveis.length)];
      jaSorteados.add(escolhidoIdx);
      resultadoEl.textContent = `Voc√™ tirou: üéÅ ${participantes[escolhidoIdx]} üéÅ`;
      btnSortear.disabled = false;
      atualizarMeta();
    }
  }, 70);
}

// Reinicia sorteio/tela
function resetar(){
  jaSorteados = new Set();
  resultadoEl.textContent = '';
  nomeInput.value = '';
  atualizarMeta();
  btnSortear.disabled = false;
}

// Atualiza lista participantes via textarea
function salvarLista(){
  const novaLista = editListArea.value.split('\n').map(l => l.trim()).filter(l => l.length > 0);
  if(novaLista.length < 2){ alert('A lista deve conter pelo menos 2 nomes.'); return; }
  participantes = novaLista;
  resetar();
  atualizarMeta();
}

// Restaurar padr√£o
function restaurarLista(){
  participantes = listaPadrao.slice();
  editListArea.value = listaPadrao.join('\n');
  resetar();
  atualizarMeta();
}

// === listeners ===
btnSortear.addEventListener('click', sortear);
btnReset.addEventListener('click', resetar);
btnSalvarLista.addEventListener('click', salvarLista);
btnRestaurarLista.addEventListener('click', restaurarLista);
nomeInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') sortear(); });

// inicializa√ß√£o
function inicializar(){
  editListArea.value = participantes.join('\n');
  atualizarMeta();
}
inicializar();

// ====== SNOW CANVAS - fix bug 'n' removido ======
(function(){
  if(window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
  const canvas = document.getElementById('snow');
  const ctx = canvas.getContext('2d');
  let W = canvas.width = window.innerWidth;
  let H = canvas.height = window.innerHeight;
  const DPR = Math.max(1, window.devicePixelRatio || 1);
  canvas.width = W * DPR; canvas.height = H * DPR; canvas.style.width = W + 'px'; canvas.style.height = H + 'px';
  ctx.scale(DPR, DPR);

  let flakes = [];
  const FLAKE_COUNT = Math.min(120, Math.floor(W/6));

  function initFlakes(){
    flakes = [];
    for(let i=0;i<FLAKE_COUNT;i++){
      flakes.push({
        x: Math.random()*W,
        y: Math.random()*H - H,
        r: 1 + Math.random()*4,
        d: Math.random()*FLAKE_COUNT,
        vx: (Math.random()*0.6)-0.3,
        vy: 0.5 + Math.random()*1.2
      });
    }
  }

  function update(){
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle = 'rgba(255,255,255,0.9)';
    for(let i=0;i<flakes.length;i++){
      const f = flakes[i];
      ctx.beginPath();
      ctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
      ctx.fill();
      f.x += f.vx + Math.sin((f.d + Date.now()/600) / 10) * 0.6;
      f.y += f.vy;
      if(f.y > H + 10){ f.y = -10; f.x = Math.random()*W; }
    }
    requestAnimationFrame(update);
  }

  function onResize(){
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    canvas.width = W * DPR; canvas.height = H * DPR; canvas.style.width = W + 'px'; canvas.style.height = H + 'px';
    ctx.setTransform(DPR,0,0,DPR,0,0);
    initFlakes();
  }

  window.addEventListener('resize', debounce(onResize, 120));
  initFlakes();
  update();

  function debounce(fn, wait){let t;return (...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),wait)}}
})();
</script>
</body>
</html>
